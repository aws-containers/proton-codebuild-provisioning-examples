infrastructure:
  templates:
    - rendering_engine: codebuild
      settings:
        image: aws/codebuild/amazonlinux2-x86_64-standard:4.0
        runtimes:
          python: 3.9
        provision:
          - cat proton-inputs.json
          # Install dependencies
          - pip install -r requirements.txt
          # Get environment name
          - ENV_NAME=$(cat proton-inputs.json | jq -r '.environment.name')
          # Get namespace name
          - NS_NAME=$(cat proton-inputs.json | jq -r '.service_instance.inputs.namespace')
          # Run create namespace script
          - chmod +x ./ns_update.py && ./ns_update.py create-namespace $NS_NAME $ENV_NAME
        deprovision:
          # Install dependencies
          - pip install -r requirements.txt
          # Get environment name
          - ENV_NAME=$(cat proton-inputs.json | jq -r '.environment.name')
          # Get namespace name
          - NS_NAME=$(cat proton-inputs.json | jq -r '.service_instance.inputs.namespace')
          # Run create namespace script
          - chmod +x ./ns_update.py && ./ns_update.py delete-namespace $NS_NAME $ENV_NAME
